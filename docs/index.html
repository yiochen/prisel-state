<!DOCTYPE html><html class="default no-js"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@prisel/state</title><meta name="description" content="Documentation for @prisel/state"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem(&quot;tsd-theme&quot;) || &quot;os&quot;)</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@prisel/state</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>@prisel/state</h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#priselstate" id="priselstate" style="color: inherit; text-decoration: none;">
  <h1>@prisel/state</h1>
</a>
<p><a href="https://badge.fury.io/js/@prisel%2Fstate"><img src="https://badge.fury.io/js/@prisel%2Fstate.svg" alt="npm
version"></a></p>
<p>Declarative and decentralized state machine inspired by React.</p>

<a href="#get-started" id="get-started" style="color: inherit; text-decoration: none;">
  <h2>Get Started</h2>
</a>
<p>Install the library from npm</p>
<pre><code><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-0">i</span><span class="hl-1"> @</span><span class="hl-0">prisel</span><span class="hl-1">/</span><span class="hl-0">state</span>
</code></pre>

<a href="#guide" id="guide" style="color: inherit; text-decoration: none;">
  <h2>Guide</h2>
</a>
<p>Each state in @prisel/state is defined as a function. A simplest state is just a noop
function, like below:</p>
<pre><code class="language-typescript"><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">Liquid</span><span class="hl-1">() {}</span>
</code></pre>
<p>State function can take a prop to initialize. A prop can be any type.</p>
<pre><code class="language-typescript"><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">Liquid</span><span class="hl-1">(</span><span class="hl-0">liquidType</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-5">&quot;type of the liquid is &quot;</span><span class="hl-1"> + </span><span class="hl-0">liquidType</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code></pre>
<p>To set this state as the initial state and run the state machine, import <code>run</code>, and pass the state function to it.</p>
<pre><code class="language-typescript"><span class="hl-6">import</span><span class="hl-1"> { </span><span class="hl-0">run</span><span class="hl-1"> } </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-5">&quot;@prisel/state&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">run</span><span class="hl-1">(</span><span class="hl-0">Liquid</span><span class="hl-1">);</span><br/><span class="hl-7">// or with props</span><br/><span class="hl-3">run</span><span class="hl-1">(</span><span class="hl-0">Liquid</span><span class="hl-1">, </span><span class="hl-5">&quot;water&quot;</span><span class="hl-1">);</span>
</code></pre>
<p>Each state can have internal state. This is useful to model numeric states which
are hard and cumbersome to convert to individual state function. For example, we
can have a temperature state.</p>
<pre><code class="language-typescript"><span class="hl-6">import</span><span class="hl-1"> { </span><span class="hl-0">useLocalState</span><span class="hl-1">, </span><span class="hl-0">run</span><span class="hl-1">, </span><span class="hl-0">StateFuncReturn</span><span class="hl-1"> } </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-5">&quot;@prisel/state&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">Liquid</span><span class="hl-1">(): </span><span class="hl-4">StateFuncReturn</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">temperature</span><span class="hl-1">, </span><span class="hl-8">setTemperature</span><span class="hl-1">] = </span><span class="hl-3">useLocalState</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-7">/* initial temperature */</span><span class="hl-1"> </span><span class="hl-9">0</span><br/><span class="hl-1">  );</span><br/><br/><span class="hl-1">  </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-0">temperature</span><span class="hl-1">); </span><span class="hl-7">// prints 0</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">run</span><span class="hl-1">(</span><span class="hl-0">Liquid</span><span class="hl-1">);</span>
</code></pre>
<p>Calling <code>setTemperature</code> with a different temperature will cause the <code>liquid</code>
function to be run again.</p>
<p>A state that does no side effect is not interesting. Let&#39;s add some side effect.</p>
<p>Similar to React&#39;s effect hook, @prisel/state has a <code>useSideEffect</code> hook that can be
used to perform side effect.</p>
<pre><code class="language-typescript"><span class="hl-3">useSideEffect</span><span class="hl-1">(</span><span class="hl-0">callback</span><span class="hl-1">, </span><span class="hl-0">deps</span><span class="hl-1">);</span>
</code></pre>
<p>For example:</p>
<pre><code class="language-typescript"><span class="hl-6">import</span><span class="hl-1"> { </span><span class="hl-0">useSideEffect</span><span class="hl-1">, </span><span class="hl-0">run</span><span class="hl-1">, </span><span class="hl-0">StateFuncReturn</span><span class="hl-1"> } </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-5">&quot;@prisel/state&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">Liquid</span><span class="hl-1">(): </span><span class="hl-4">StateFuncReturn</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">temperature</span><span class="hl-1">, </span><span class="hl-8">setTemperature</span><span class="hl-1">] = </span><span class="hl-3">useLocalState</span><span class="hl-1">(</span><span class="hl-9">0</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">useSideEffect</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// this will be run after the boiling state function is run.</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">intervalId</span><span class="hl-1"> = </span><span class="hl-3">setInterval</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">setTemperature</span><span class="hl-1">((</span><span class="hl-0">oldTemp</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-0">oldTemp</span><span class="hl-1"> + </span><span class="hl-9">10</span><span class="hl-1">);</span><br/><span class="hl-1">    }, </span><span class="hl-9">100</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">clearInterval</span><span class="hl-1">(</span><span class="hl-0">intervalId</span><span class="hl-1">);</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">  }); </span><span class="hl-7">// an empty dependencies array means side effect will be run only once when entering this state</span><br/><br/><span class="hl-1">  </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-0">temperature</span><span class="hl-1">); </span><span class="hl-7">// will print 0, 10, 20, 30 ...</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">run</span><span class="hl-1">(</span><span class="hl-0">Liquid</span><span class="hl-1">);</span>
</code></pre>
<p>To transition to new state, return a new state configuration from the function.
A state configuration can be constructed using <code>newState(stateFunc, props)</code>
function.</p>
<pre><code class="language-typescript"><span class="hl-6">import</span><span class="hl-1"> { </span><span class="hl-0">useSideEffect</span><span class="hl-1">, </span><span class="hl-0">run</span><span class="hl-1">, </span><span class="hl-0">newState</span><span class="hl-1">, </span><span class="hl-0">StateFuncReturn</span><span class="hl-1"> } </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-5">&quot;@prisel/state&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">Liquid</span><span class="hl-1">(): </span><span class="hl-4">StateFuncReturn</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">temperature</span><span class="hl-1">, </span><span class="hl-8">setTemperature</span><span class="hl-1">] = </span><span class="hl-3">useLocalState</span><span class="hl-1">(</span><span class="hl-9">0</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">useSideEffect</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// this will be run after the boiling state function is run.</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">intervalId</span><span class="hl-1"> = </span><span class="hl-3">setInterval</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">setTemperature</span><span class="hl-1">((</span><span class="hl-0">oldTemp</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-0">oldTemp</span><span class="hl-1"> + </span><span class="hl-9">10</span><span class="hl-1">);</span><br/><span class="hl-1">    }, </span><span class="hl-9">100</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">clearInterval</span><span class="hl-1">(</span><span class="hl-0">intervalId</span><span class="hl-1">);</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">  }, []); </span><span class="hl-7">// an empty dependencies array means side effect will be run only once when entering this state</span><br/><br/><span class="hl-1">  </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-0">temperature</span><span class="hl-1"> &gt;= </span><span class="hl-9">100</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-3">newState</span><span class="hl-1">(</span><span class="hl-0">vapor</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">Vapor</span><span class="hl-1">() {</span><br/><span class="hl-1">  </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-5">&quot;vaporized!&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">run</span><span class="hl-1">(</span><span class="hl-0">Liquid</span><span class="hl-1">);</span>
</code></pre>
<p>State can also receive events. A event is a string name and any associated data.
To subscribe to an event, use <code>useEvent</code>.</p>
<pre><code class="language-typescript"><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">triggered</span><span class="hl-1">, </span><span class="hl-8">eventData</span><span class="hl-1">] = </span><span class="hl-3">useEvent</span><span class="hl-1">(</span><span class="hl-0">eventName</span><span class="hl-1">);</span>
</code></pre>
<p><code>useEvent</code> takes a string event name to subscribe to this event. When the event
is triggered, the state function will be called and useEvent will return <code>[true, eventData]</code>. If state function is called for other reasons (e.g.
<code>setLocalState</code>), <code>useEvent</code> will return <code>[false, undefined]</code>.</p>
<pre><code class="language-typescript"><span class="hl-6">import</span><span class="hl-1"> { </span><span class="hl-0">run</span><span class="hl-1">, </span><span class="hl-0">newState</span><span class="hl-1">, </span><span class="hl-0">StateFuncReturn</span><span class="hl-1"> } </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-5">&quot;@prisel/state&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">Liquid</span><span class="hl-1">(): </span><span class="hl-4">StateFuncReturn</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">boiled</span><span class="hl-1">, </span><span class="hl-8">time</span><span class="hl-1">] = </span><span class="hl-3">useEvent</span><span class="hl-1">&lt;</span><span class="hl-4">number</span><span class="hl-1">&gt;(</span><span class="hl-5">&quot;boil&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">// typescript wasn&#39;t able to infer time is defined if we destructure the</span><br/><span class="hl-1">  </span><span class="hl-7">// tuple before narrowing down the tuple type</span><br/><span class="hl-1">  </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-0">boiled</span><span class="hl-1"> &amp;&amp; </span><span class="hl-0">time</span><span class="hl-1"> != </span><span class="hl-2">undefined</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-3">newState</span><span class="hl-1">(</span><span class="hl-0">vapor</span><span class="hl-1">, </span><span class="hl-0">time</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">Vapor</span><span class="hl-1">(</span><span class="hl-0">timeToBoil</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-5">`vaporized in </span><span class="hl-2">${</span><span class="hl-0">timeToBoil</span><span class="hl-2">}</span><span class="hl-5"> seconds`</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code></pre>
<p>To send an event to a currently running state (and it&#39;s child states), use the inspector returned from
<code>run</code></p>
<pre><code class="language-typescript"><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">Liquid</span><span class="hl-1">(): </span><span class="hl-4">StateFuncReturn</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">boiled</span><span class="hl-1">, </span><span class="hl-8">time</span><span class="hl-1">] = </span><span class="hl-3">useEvent</span><span class="hl-1">&lt;</span><span class="hl-4">number</span><span class="hl-1">&gt;(</span><span class="hl-5">&quot;boil&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-0">boiled</span><span class="hl-1"> &amp;&amp; </span><span class="hl-0">time</span><span class="hl-1"> != </span><span class="hl-2">undefined</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-3">newState</span><span class="hl-1">(</span><span class="hl-0">vapor</span><span class="hl-1">, </span><span class="hl-0">time</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">Vapor</span><span class="hl-1">(</span><span class="hl-0">timeToBoil</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-5">`vaporized in </span><span class="hl-2">${</span><span class="hl-0">timeToBoil</span><span class="hl-2">}</span><span class="hl-5"> seconds`</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">inspector</span><span class="hl-1"> = </span><span class="hl-3">run</span><span class="hl-1">(</span><span class="hl-0">Liquid</span><span class="hl-1">);</span><br/><span class="hl-0">inspector</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-5">&quot;boil&quot;</span><span class="hl-1">, </span><span class="hl-9">10</span><span class="hl-1">);</span>
</code></pre>
<p>To send an event to all active states, use <code>inspector.sendAll</code>.</p>
<p>To get inspector inside a state function, we can use <code>useInspector</code> hook.</p>
<pre><code class="language-typescript"><span class="hl-6">import</span><span class="hl-1"> { </span><span class="hl-0">useInspector</span><span class="hl-1">, </span><span class="hl-0">useLocalState</span><span class="hl-1">, </span><span class="hl-0">useSideEffect</span><span class="hl-1"> } </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-5">&quot;@prisel/state&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">Liquid</span><span class="hl-1">(): </span><span class="hl-4">StateFuncReturn</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">temperature</span><span class="hl-1">, </span><span class="hl-8">setTemperature</span><span class="hl-1">] = </span><span class="hl-3">useLocalState</span><span class="hl-1">(</span><span class="hl-9">0</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">heated</span><span class="hl-1">] = </span><span class="hl-3">useEvent</span><span class="hl-1">(</span><span class="hl-5">&quot;heat&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">useSideEffect</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-0">heated</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">setTemperature</span><span class="hl-1">((</span><span class="hl-0">oldTemperature</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-0">oldTemperature</span><span class="hl-1"> + </span><span class="hl-9">10</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">HeaterActive</span><span class="hl-1">(): </span><span class="hl-4">StateFuncReturn</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">inspector</span><span class="hl-1"> = </span><span class="hl-3">useInspector</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-3">useSideEffect</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">intervalId</span><span class="hl-1"> = </span><span class="hl-3">setInterval</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">inspector</span><span class="hl-1">.</span><span class="hl-3">sendAll</span><span class="hl-1">(</span><span class="hl-5">&quot;heat&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    }, </span><span class="hl-9">100</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">clearInterval</span><span class="hl-1">(</span><span class="hl-0">intervalId</span><span class="hl-1">);</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">run</span><span class="hl-1">(</span><span class="hl-0">Liquid</span><span class="hl-1">);</span><br/><span class="hl-3">run</span><span class="hl-1">(</span><span class="hl-0">HeaterActive</span><span class="hl-1">);</span>
</code></pre>
<p>State transititons are useful to describe a series of actions to be performed in
sequence. Within a state, we can also start nested states. comparing to normal
state, nested states have the following properties:</p>
<ol>
<li>Nested states and parent state coexists. Starting a nested state won&#39;t replace
the current state.</li>
<li>Nested states will be cancelled when parent state transitions to other state.</li>
<li>When a nested state transitions to end state, the parent state will get
notified and receives results.</li>
</ol>
<pre><code class="language-typescript"><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">Parent</span><span class="hl-1">(): </span><span class="hl-4">StateFuncReturn</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">useSideEffect</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-5">&quot;parent started&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  }, []);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">startChild</span><span class="hl-1">] = </span><span class="hl-3">useEvent</span><span class="hl-1">(</span><span class="hl-5">&quot;start-child&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">childDone</span><span class="hl-1">, </span><span class="hl-8">result</span><span class="hl-1">] = </span><span class="hl-3">useNested</span><span class="hl-1">(</span><span class="hl-0">startChild</span><span class="hl-1">, </span><span class="hl-0">child</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-0">childDone</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-5">&quot;parent ended because &quot;</span><span class="hl-1"> + </span><span class="hl-0">result</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-3">endState</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">Child</span><span class="hl-1">(): </span><span class="hl-4">StateFuncReturn</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">useSideEffect</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-5">&quot;child started&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  }, []);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">finishChild</span><span class="hl-1">] = </span><span class="hl-3">useEvent</span><span class="hl-1">(</span><span class="hl-5">&quot;finish-child&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-0">finishChild</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">childMessage</span><span class="hl-1"> = </span><span class="hl-5">&quot;child ended&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-5">&quot;child ended by event&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-3">endState</span><span class="hl-1">(</span><span class="hl-0">childMessage</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">inspector</span><span class="hl-1"> = </span><span class="hl-3">run</span><span class="hl-1">(</span><span class="hl-0">Parent</span><span class="hl-1">);</span><br/><span class="hl-3">setTimeout</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">inspector</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-5">&quot;start-child&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">}, </span><span class="hl-9">0</span><span class="hl-1">);</span><br/><span class="hl-3">setTimeout</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">inspector</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-5">&quot;finish-child&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">}, </span><span class="hl-9">0</span><span class="hl-1">);</span><br/><br/><span class="hl-7">// prints</span><br/><span class="hl-7">// parent started</span><br/><span class="hl-7">// child started</span><br/><span class="hl-7">// child ended by event</span><br/><span class="hl-7">// parent ended because child ended</span>
</code></pre>
<p>Let&#39;s put everything together for a complex problem. Suppose we want to build an
online chat room, with maximum capacity of 10 users.</p>
<pre><code class="language-typescript"><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">ChatroomOpen</span><span class="hl-1">(</span><span class="hl-0">capacity</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">users</span><span class="hl-1">, </span><span class="hl-8">setUsers</span><span class="hl-1">] = </span><span class="hl-3">useLocalState</span><span class="hl-1">&lt;</span><span class="hl-4">string</span><span class="hl-1">[]&gt;([]);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">userJoined</span><span class="hl-1">, </span><span class="hl-8">fromUserId</span><span class="hl-1">] = </span><span class="hl-3">useEvent</span><span class="hl-1">(</span><span class="hl-5">&quot;join-request&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">useSideEffect</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-0">userJoined</span><span class="hl-1"> &amp;&amp; </span><span class="hl-0">users</span><span class="hl-1">.</span><span class="hl-0">length</span><span class="hl-1"> &lt; </span><span class="hl-0">capacity</span><span class="hl-1"> &amp;&amp; </span><span class="hl-0">fromUserId</span><span class="hl-1"> != </span><span class="hl-2">undefined</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">setUsers</span><span class="hl-1">([...</span><span class="hl-0">users</span><span class="hl-1">, </span><span class="hl-0">fromUserId</span><span class="hl-1">]);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">run</span><span class="hl-1">(</span><span class="hl-0">ChatroomOpen</span><span class="hl-1">, </span><span class="hl-9">10</span><span class="hl-1">);</span>
</code></pre>
<p>Now if for every joined user, we want them to sign a code of conduct before
sending message. Signing code of conduct involves, sending user a request, and
waiting for user&#39;s response. Let&#39;s define the process of code of conduct.</p>
<pre><code class="language-typescript"><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">UserJoined</span><span class="hl-1">(</span><span class="hl-0">userId</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">useEffect</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// let&#39;s assume we have a api for sending user request</span><br/><span class="hl-1">    </span><span class="hl-0">api</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-0">userId</span><span class="hl-1">, </span><span class="hl-5">&quot;code of conduct&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  }, []);</span><br/><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">codeOfConductResponse</span><span class="hl-1">, </span><span class="hl-8">fromUserId</span><span class="hl-1">] = </span><span class="hl-3">useEvent</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;code-of-conduct-response&quot;</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">  </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-0">codeOfConductResponse</span><span class="hl-1"> &amp;&amp; </span><span class="hl-0">userId</span><span class="hl-1"> === </span><span class="hl-0">fromUserId</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-3">newState</span><span class="hl-1">(</span><span class="hl-0">UserActive</span><span class="hl-1">, </span><span class="hl-0">userId</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">UserActive</span><span class="hl-1">(</span><span class="hl-0">userId</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">// To be implemented</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Let&#39;s connect room&#39;s state with user&#39;s state. In <code>chatroomOpen</code>, we can run a
new <code>userJoined</code> everytime a user joins.</p>
<pre><code class="language-diff"><span class="hl-1">function ChatroomOpen(capacity: number) {</span><br/><span class="hl-1">  const [users, setUsers] = useLocalState([]);</span><br/><span class="hl-1">  const [userJoined, fromUserId] = useEvent(&quot;join-request&quot;);</span><br/><span class="hl-1">  useEffect(() =&gt; {</span><br/><span class="hl-1">    if (userJoined &amp;&amp; users.length &lt; capacity) {</span><br/><span class="hl-1">      setUsers([...users, fromUserId]);</span><br/><span class="hl-9">+     run(userJoined, fromUserId);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Now let&#39;s implement the fun part. When user is active, they can broadcast
messages to other active users in the room, but not users who haven&#39;t signed the
code of conduct.</p>
<pre><code class="language-diff"><span class="hl-1">function UserActive(userId) {</span><br/><span class="hl-9">+ const inspector = useInspector();</span><br/><span class="hl-9">+ const [receivedMessage, { fromUserId, message }] =</span><br/><span class="hl-9">+   useEvent&lt;{ fromUserId: string; message: string }&gt;(&quot;message-request&quot;);</span><br/><span class="hl-9">+ useSideEffect(() =&gt; {</span><br/><span class="hl-9">+   if (receivedMessageRequest &amp;&amp; messageRequest?.fromUserId === userId) {</span><br/><span class="hl-9">+     inspector.sendAll(&quot;broadcast-message&quot;, { fromUserId, message });</span><br/><span class="hl-9">+   }</span><br/><span class="hl-9">+ });</span><br/><span class="hl-9">+ const [broadcastMessage, broadcastData] =</span><br/><span class="hl-9">+   useEvent&lt;{ fromUserId: string; message: string }&gt;(&quot;broadcast-message&quot;);</span><br/><span class="hl-9">+ useSideEffect(() =&gt; {</span><br/><span class="hl-9">+   if (broadcastMessage &amp;&amp; broadcastData) {</span><br/><span class="hl-9">+       api.send(</span><br/><span class="hl-9">+         userId,</span><br/><span class="hl-9">+         `${broadcastData.fromUserId} says: ${broadcastData.message}`</span><br/><span class="hl-9">+       );</span><br/><span class="hl-9">+     }</span><br/><span class="hl-9">+ });</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Let&#39;s handle user leaving. When a user leaves, they shouldn&#39;t be able to receive
any messages. If they are still working on code of conduct, they should also be
able to leave. This means both <code>userJoined</code> and <code>userActive</code> state can
transition to a new <code>userLeft</code> state. When user leaves, we only want to tell
room to remove the user, so that it has capacity for more new users.</p>
<pre><code class="language-typescript"><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">UserLeft</span><span class="hl-1">(</span><span class="hl-0">userId</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">inspector</span><span class="hl-1"> = </span><span class="hl-3">useInspector</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-3">useSideEffect</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">inspector</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-5">&quot;user-left&quot;</span><span class="hl-1">, </span><span class="hl-0">userId</span><span class="hl-1">);</span><br/><span class="hl-1">  }, []);</span><br/><span class="hl-1">  </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-3">endState</span><span class="hl-1">();</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Let&#39;s listen for this event in <code>ChatroomOpen</code> state</p>
<pre><code class="language-diff"><span class="hl-1">function ChatroomOpen(capacity: number) {</span><br/><span class="hl-1">  const [users, setUsers] = useLocalState([]);</span><br/><span class="hl-1">  const [userJoined, joinUserId] = useEvent(&quot;join-request&quot;);</span><br/><span class="hl-9">+ const [userLeft, leftUserId] = useEvent(&quot;user-left&quot;);</span><br/><span class="hl-1">  useEffect(() =&gt; {</span><br/><span class="hl-1">    if (userJoined &amp;&amp; users.length &lt; capacity &amp;&amp; fromUserId != undefined) {</span><br/><span class="hl-1">      setUsers([...users, joinUserId]);</span><br/><span class="hl-1">      run(UserJoined, fromUserId)</span><br/><span class="hl-1">    }</span><br/><span class="hl-9">+   if (userLeft &amp;&amp; leftUserId != undefined &amp;&amp; users.includes(leftUserId)) {</span><br/><span class="hl-9">+     setUsers(users.filter((user) =&gt; user != leftUserId));</span><br/><span class="hl-9">+   }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span>
</code></pre>
<p>To transition from <code>userJoined</code> and <code>userActive</code> to <code>userLeft</code>, both
<code>userJoined</code> and <code>userActive</code> needs to add logic for listening for user&#39;s leave
request. We can extract this common logic to another function. If you are
familiar with React, this is called custom hooks.</p>
<p>Custom hooks are usually named <code>useXXX</code>.</p>
<pre><code class="language-typescript"><span class="hl-7">/**</span><br/><span class="hl-7"> * Listen for the leave request of given userId. If received, return true, otherwise, return false</span><br/><span class="hl-7"> */</span><br/><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">useLeaveEvent</span><span class="hl-1">(</span><span class="hl-0">userId</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">userLeft</span><span class="hl-1">, </span><span class="hl-8">leftUserId</span><span class="hl-1">] = </span><span class="hl-3">useEvent</span><span class="hl-1">(</span><span class="hl-5">&quot;leave-request&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-0">userLeft</span><span class="hl-1"> &amp;&amp; </span><span class="hl-0">leftUserId</span><span class="hl-1"> === </span><span class="hl-0">userId</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Then add the following to both <code>userJoined</code> and <code>userActive</code></p>
<pre><code class="language-typescript"><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">left</span><span class="hl-1"> = </span><span class="hl-3">useLeaveEvent</span><span class="hl-1">(</span><span class="hl-0">userId</span><span class="hl-1">);</span><br/><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-0">left</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-3">newState</span><span class="hl-1">(</span><span class="hl-0">userLeft</span><span class="hl-1">, </span><span class="hl-0">userId</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code></pre>
<p>The following is the complete code:</p>
<pre><code class="language-typescript"><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">ChatroomOpen</span><span class="hl-1">(</span><span class="hl-0">capacity</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">users</span><span class="hl-1">, </span><span class="hl-8">setUsers</span><span class="hl-1">] = </span><span class="hl-3">useLocalState</span><span class="hl-1">&lt;</span><span class="hl-4">string</span><span class="hl-1">[]&gt;([]);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">userJoined</span><span class="hl-1">, </span><span class="hl-8">fromUserId</span><span class="hl-1">] = </span><span class="hl-3">useEvent</span><span class="hl-1">(</span><span class="hl-5">&quot;join-request&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">userLeft</span><span class="hl-1">, </span><span class="hl-8">leftUserId</span><span class="hl-1">] = </span><span class="hl-3">useEvent</span><span class="hl-1">(</span><span class="hl-5">&quot;user-left&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-3">useSideEffect</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-0">userJoined</span><span class="hl-1"> &amp;&amp; </span><span class="hl-0">users</span><span class="hl-1">.</span><span class="hl-0">length</span><span class="hl-1"> &lt; </span><span class="hl-0">capacity</span><span class="hl-1"> &amp;&amp; </span><span class="hl-0">fromUserId</span><span class="hl-1"> != </span><span class="hl-2">undefined</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">setUsers</span><span class="hl-1">([...</span><span class="hl-0">users</span><span class="hl-1">, </span><span class="hl-0">fromUserId</span><span class="hl-1">]);</span><br/><span class="hl-1">      </span><span class="hl-3">run</span><span class="hl-1">(</span><span class="hl-0">UserJoined</span><span class="hl-1">, </span><span class="hl-0">fromUserId</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-0">userLeft</span><span class="hl-1"> &amp;&amp; </span><span class="hl-0">leftUserId</span><span class="hl-1"> != </span><span class="hl-2">undefined</span><span class="hl-1"> &amp;&amp; </span><span class="hl-0">users</span><span class="hl-1">.</span><span class="hl-3">includes</span><span class="hl-1">(</span><span class="hl-0">leftUserId</span><span class="hl-1">)) {</span><br/><span class="hl-1">      </span><span class="hl-3">setUsers</span><span class="hl-1">(</span><span class="hl-0">users</span><span class="hl-1">.</span><span class="hl-3">filter</span><span class="hl-1">((</span><span class="hl-0">user</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-0">user</span><span class="hl-1"> != </span><span class="hl-0">leftUserId</span><span class="hl-1">));</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-7">// user states</span><br/><br/><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">UserJoined</span><span class="hl-1">(</span><span class="hl-0">userId</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">useSideEffect</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// let&#39;s assume we have a api for sending user request</span><br/><span class="hl-1">    </span><span class="hl-0">api</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-0">userId</span><span class="hl-1">, </span><span class="hl-5">&quot;code of conduct&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  }, []);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">codeOfConductResponse</span><span class="hl-1">, </span><span class="hl-8">fromUserId</span><span class="hl-1">] = </span><span class="hl-3">useEvent</span><span class="hl-1">&lt;</span><span class="hl-4">string</span><span class="hl-1">&gt;(</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;code-of-conduct-response&quot;</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">left</span><span class="hl-1"> = </span><span class="hl-3">useLeaveEvent</span><span class="hl-1">(</span><span class="hl-0">userId</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-0">left</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-3">newState</span><span class="hl-1">(</span><span class="hl-0">UserLeft</span><span class="hl-1">, </span><span class="hl-0">userId</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-0">codeOfConductResponse</span><span class="hl-1"> &amp;&amp; </span><span class="hl-0">userId</span><span class="hl-1"> === </span><span class="hl-0">fromUserId</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-3">newState</span><span class="hl-1">(</span><span class="hl-0">UserActive</span><span class="hl-1">, </span><span class="hl-0">userId</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">UserActive</span><span class="hl-1">(</span><span class="hl-0">userId</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">inspector</span><span class="hl-1"> = </span><span class="hl-3">useInspector</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">receivedMessageRequest</span><span class="hl-1">, </span><span class="hl-8">messageRequest</span><span class="hl-1">] =</span><br/><span class="hl-1">    </span><span class="hl-3">useEvent</span><span class="hl-1">&lt;{ </span><span class="hl-0">fromUserId</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">; </span><span class="hl-0">message</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1"> }&gt;(</span><span class="hl-5">&quot;message-request&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">useSideEffect</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-0">receivedMessageRequest</span><span class="hl-1"> &amp;&amp; </span><span class="hl-0">messageRequest</span><span class="hl-1">?.</span><span class="hl-0">fromUserId</span><span class="hl-1"> === </span><span class="hl-0">userId</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">inspector</span><span class="hl-1">.</span><span class="hl-3">sendAll</span><span class="hl-1">(</span><span class="hl-5">&quot;broadcast-message&quot;</span><span class="hl-1">, </span><span class="hl-0">messageRequest</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">broadcastMessage</span><span class="hl-1">, </span><span class="hl-8">broadcastData</span><span class="hl-1">] =</span><br/><span class="hl-1">    </span><span class="hl-3">useEvent</span><span class="hl-1">&lt;{ </span><span class="hl-0">fromUserId</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">; </span><span class="hl-0">message</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1"> }&gt;(</span><span class="hl-5">&quot;broadcast-message&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">useSideEffect</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-0">broadcastMessage</span><span class="hl-1"> &amp;&amp; </span><span class="hl-0">broadcastData</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">api</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-0">userId</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-5">`</span><span class="hl-2">${</span><span class="hl-0">broadcastData</span><span class="hl-10">.</span><span class="hl-0">fromUserId</span><span class="hl-2">}</span><span class="hl-5"> says: </span><span class="hl-2">${</span><span class="hl-0">broadcastData</span><span class="hl-10">.</span><span class="hl-0">message</span><span class="hl-2">}</span><span class="hl-5">`</span><br/><span class="hl-1">      );</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">left</span><span class="hl-1"> = </span><span class="hl-3">useLeaveEvent</span><span class="hl-1">(</span><span class="hl-0">userId</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-0">left</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-3">newState</span><span class="hl-1">(</span><span class="hl-0">UserLeft</span><span class="hl-1">, </span><span class="hl-0">userId</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">useLeaveEvent</span><span class="hl-1">(</span><span class="hl-0">userId</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">userLeft</span><span class="hl-1">, </span><span class="hl-8">leftUserId</span><span class="hl-1">] = </span><span class="hl-3">useEvent</span><span class="hl-1">(</span><span class="hl-5">&quot;leave-request&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-0">userLeft</span><span class="hl-1"> &amp;&amp; </span><span class="hl-0">leftUserId</span><span class="hl-1"> === </span><span class="hl-0">userId</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">UserLeft</span><span class="hl-1">(</span><span class="hl-0">userId</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">inspector</span><span class="hl-1"> = </span><span class="hl-3">useInspector</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-3">useSideEffect</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">inspector</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-5">&quot;user-left&quot;</span><span class="hl-1">, </span><span class="hl-0">userId</span><span class="hl-1">);</span><br/><span class="hl-1">  }, []);</span><br/><span class="hl-1">  </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-3">endState</span><span class="hl-1">();</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">run</span><span class="hl-1">(</span><span class="hl-0">ChatroomOpen</span><span class="hl-1">, </span><span class="hl-9">10</span><span class="hl-1">);</span>
</code></pre>

<a href="#event" id="event" style="color: inherit; text-decoration: none;">
  <h2>Event</h2>
</a>
<p>To create an event, use <code>newEvent</code>.</p>
<pre><code class="language-typescript"><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">event</span><span class="hl-1">, </span><span class="hl-8">emitter</span><span class="hl-1">] = </span><span class="hl-3">newEvent</span><span class="hl-1">&lt;</span><span class="hl-4">EventDataT</span><span class="hl-1">&gt;(</span><span class="hl-0">eventName</span><span class="hl-1">);</span>
</code></pre>
<p>for example</p>
<pre><code class="language-typescript"><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-8">diceRoll</span><span class="hl-1">, </span><span class="hl-8">emitter</span><span class="hl-1">] = </span><span class="hl-3">newEvent</span><span class="hl-1">&lt;</span><span class="hl-4">number</span><span class="hl-1">&gt;(</span><span class="hl-5">&quot;dice-roll&quot;</span><span class="hl-1">);</span>
</code></pre>
<p>Event can be filtered, so that only when certain condititons about the event
data are met, the event will be triggered.</p>
<pre><code class="language-typescript"><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">diceRollWith5</span><span class="hl-1"> = </span><span class="hl-0">diceRoll</span><span class="hl-1">.</span><span class="hl-3">filter</span><span class="hl-1">((</span><span class="hl-0">num</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-0">num</span><span class="hl-1"> === </span><span class="hl-9">5</span><span class="hl-1">); </span><span class="hl-7">// this creates a new event that can be triggered using the same emitter</span>
</code></pre>
<p>Event can also be transformed to another type.</p>
<pre><code class="language-typescript"><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">diceRollOddNumber</span><span class="hl-1"> = </span><span class="hl-0">diceRoll</span><span class="hl-1">.</span><span class="hl-3">map</span><span class="hl-1">((</span><span class="hl-0">num</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-0">num</span><span class="hl-1"> % </span><span class="hl-9">2</span><span class="hl-1"> === </span><span class="hl-9">1</span><span class="hl-1">); </span><span class="hl-7">// this also creates a new event tthat can be triggered using the same emitter. The result event data will be converted boolean</span>
</code></pre>
<p>Event can be sent using inspector.</p>
<pre><code class="language-typescript"><span class="hl-0">inspector</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-0">diceRollEmitter</span><span class="hl-1">, </span><span class="hl-9">2</span><span class="hl-1">);</span>
</code></pre>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-interface"><a href="interfaces/EffectFunc.html" class="tsd-kind-icon">Effect<wbr/>Func</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/Emitter.html" class="tsd-kind-icon">Emitter</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/Event.html" class="tsd-kind-icon">Event</a></li><li class="tsd-kind-interface"><a href="interfaces/EventRef.html" class="tsd-kind-icon">Event<wbr/>Ref</a></li><li class="tsd-kind-interface"><a href="interfaces/Inspector.html" class="tsd-kind-icon">Inspector</a></li><li class="tsd-kind-interface"><a href="interfaces/RunConfig.html" class="tsd-kind-icon">Run<wbr/>Config</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/SetLocalState.html" class="tsd-kind-icon">Set<wbr/>Local<wbr/>State</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/StateConfig.html" class="tsd-kind-icon">State<wbr/>Config</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#EventResult" class="tsd-kind-icon">Event<wbr/>Result</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#NestedState" class="tsd-kind-icon">Nested<wbr/>State</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#StateFunc" class="tsd-kind-icon">State<wbr/>Func</a></li><li class="tsd-kind-type-alias"><a href="modules.html#StateFuncReturn" class="tsd-kind-icon">State<wbr/>Func<wbr/>Return</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#endState" class="tsd-kind-icon">end<wbr/>State</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#newEvent" class="tsd-kind-icon">new<wbr/>Event</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#newState" class="tsd-kind-icon">new<wbr/>State</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#run" class="tsd-kind-icon">run</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#useEvent" class="tsd-kind-icon">use<wbr/>Event</a></li><li class="tsd-kind-function"><a href="modules.html#useInspector" class="tsd-kind-icon">use<wbr/>Inspector</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#useLocalState" class="tsd-kind-icon">use<wbr/>Local<wbr/>State</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#useNested" class="tsd-kind-icon">use<wbr/>Nested</a></li><li class="tsd-kind-function"><a href="modules.html#useSideEffect" class="tsd-kind-icon">use<wbr/>Side<wbr/>Effect</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>